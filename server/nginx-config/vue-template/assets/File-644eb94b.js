var J=Object.defineProperty;var K=(i,d,f)=>d in i?J(i,d,{enumerable:!0,configurable:!0,writable:!0,value:f}):i[d]=f;var m=(i,d,f)=>(K(i,typeof d!="symbol"?d+"":d,f),f);/* empty css             */import{E as M,a as X,v as O}from"./el-form-item-b11b2e63.js";import{E as Z}from"./el-overlay-019d04bc.js";import{E as G,c as H,a as Q,b as Y}from"./el-table-column-d67fdcea.js";import{h as U,A as r,K as w,L as u,x as p,J as k,aw as E,az as ee,aK as le,aL as oe,ac as te,N as y,X as l,C as o,V as s,W as h,B as I,at as V,E as ne,aa as ie}from"./index-28d2205f.js";import{F as ae,T as F}from"./Tools-bd95c3f8.js";import{P as se}from"./ServerResultInfo-97d8ba58.js";import{P as z}from"./PageComp-f8d068d7.js";import{_ as $}from"./_plugin-vue_export-helper-c27b6911.js";import{a as ue}from"./index-6a4cd27f.js";import"./_Uint8Array-a422b571.js";import"./index-ca1988ff.js";class q{constructor(){m(this,"contentType",null);m(this,"fid",null);m(this,"fileSize",null);m(this,"fileinfo",null);m(this,"filename",null);m(this,"lastupdate",null);m(this,"uid",null)}}const de={class:"main"},re={key:0},fe=["src"],ce={key:1},pe=["src"],me={key:2},_e=["src"],ge=U({__name:"FilePreviewComp",props:{info:{type:Object,required:!0}},setup(i){return(d,f)=>{var e,c,C;return r(),w("div",de,[(e=i.info.contentType)!=null&&e.toString().startsWith("image/")?(r(),w("div",re,[u("img",{src:p(E).getDownloadUrl(i.info.fid),alt:""},null,8,fe)])):k("",!0),(c=i.info.contentType)!=null&&c.toString().startsWith("video/")?(r(),w("div",ce,[u("video",{src:p(E).getDownloadUrl(i.info.fid),controls:""},null,8,pe)])):k("",!0),(C=i.info.contentType)!=null&&C.toString().startsWith("audio/")?(r(),w("div",me,[u("audio",{src:p(E).getDownloadUrl(i.info.fid),controls:""},null,8,_e)])):k("",!0)])}}});const ve=$(ge,[["__scopeId","data-v-604466ec"]]),ye={key:0},be={key:1},Fe="文件管理",we=U({__name:"File",setup(i){const d=ee(),{loginUser:f}=le(oe()),e=te({page:new se,list:new Array,queryInfo:new q,avisible:!1,addInfo:new q,selectedFile:new ae,uploading:!1,fvisible:!1,vfile:new q});e.page.pageSize=3;function c(){E.post("/user/file/queryAll",F.concatJson(e.queryInfo,e.page),a=>{a.success&&(e.list=a.list,e.page=a.page)})}function C(){e.page.pageNumber=1,c()}function B(){e.selectedFile.file=null,F.openFile(a=>{e.selectedFile=a[0]})}function D(){e.selectedFile.file=null,e.addInfo.fileinfo="",e.avisible=!0}function N(){if(e.uploading=!0,e.selectedFile.size>F.MAX_FILE_SIZE){e.uploading=!1,V.alert("文件大小超过限制","上传文件");return}E.upload("/user/file/upload",e.selectedFile.file,{fileinfo:e.addInfo.fileinfo},a=>{e.uploading=!1,a.success&&(V.alert(a.message,"上传文件"),e.selectedFile.file=null,e.addInfo.fileinfo="")})}function P(a){V.confirm(`是否删除文件：${a.filename}？`,"删除确认",{type:"warning"}).then(()=>{const n=G.service({lock:!0,text:"文件删除中，请稍候。。。"});E.post("/user/file/delete",a,_=>{n.close(),V.alert(_.message,"删除结果"),_.success&&c()},!0)}).catch(()=>{})}function A(a){e.vfile=a,e.fvisible=!0}return c(),(a,n)=>{const _=ne,g=M,v=ie,x=X,L=H,b=Q,R=Y,j=ue,S=Z,T=O;return p(f).isLogin?(r(),w("div",ye,[u("div",null,y(p(f).tbUser.username)+"的"+y(Fe),1),u("div",null,[l(L,{justify:"end",class:"pd10"},{default:o(()=>[l(x,{inline:!0},{default:o(()=>[l(g,null,{default:o(()=>[l(_,{placeholder:"文件名称模糊查询",modelValue:e.queryInfo.filename,"onUpdate:modelValue":n[0]||(n[0]=t=>e.queryInfo.filename=t)},null,8,["modelValue"])]),_:1}),l(g,null,{default:o(()=>[l(_,{placeholder:"文件描述模糊查询",modelValue:e.queryInfo.fileinfo,"onUpdate:modelValue":n[1]||(n[1]=t=>e.queryInfo.fileinfo=t)},null,8,["modelValue"])]),_:1}),l(g,null,{default:o(()=>[l(_,{placeholder:"文件类型模糊查询",modelValue:e.queryInfo.contentType,"onUpdate:modelValue":n[2]||(n[2]=t=>e.queryInfo.contentType=t)},null,8,["modelValue"])]),_:1}),l(g,null,{default:o(()=>[l(v,{onClick:n[3]||(n[3]=t=>C()),type:"primary"},{default:o(()=>[s("查询")]),_:1})]),_:1}),l(g,null,{default:o(()=>[l(v,{type:"success",onClick:D},{default:o(()=>[s("添加")]),_:1})]),_:1})]),_:1})]),_:1})]),u("div",null,[l(R,{data:e.list},{default:o(()=>[l(b,{prop:"filename",label:"文件名称"}),l(b,{prop:"fileinfo",label:"文件描述"}),l(b,{prop:"contentType",label:"文件类型"}),l(b,{label:"文件大小"},{default:o(t=>[s(y(p(F).formatFileSize(t.row.fileSize)),1)]),_:1}),l(b,{label:"信息最后修改时间"},{default:o(t=>[s(y(p(F).formatDate(t.row.lastupdate)),1)]),_:1}),l(b,{label:"操作"},{default:o(t=>[l(v,{onClick:W=>P(t.row),type:"danger"},{default:o(()=>[s("删除")]),_:2},1032,["onClick"]),l(v,{onClick:W=>A(t.row),type:"success"},{default:o(()=>[s("预览")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),u("div",null,[l(z,{page:e.page,onNumberChange:c},{default:o(()=>[s("文件分页信息：")]),"page-end":o(()=>[s("总页数："+y(e.page.pageCount),1)]),_:1},8,["page"]),l(z,{"hide-on-single-page":!1,page:e.page,sizes:[3,5,10,20],layout:"sizes, jumper, prev, pager, next, total",onNumberChange:c,onSizeChange:C},null,8,["page"])])]),u("div",null,[l(S,{modelValue:e.avisible,"onUpdate:modelValue":n[6]||(n[6]=t=>e.avisible=t),title:"文件上传","close-on-click-modal":!1,onClosed:c,width:"30%"},{footer:o(()=>[h((r(),I(v,{type:"danger",onClick:n[5]||(n[5]=t=>e.avisible=!1)},{default:o(()=>[s("关闭")]),_:1})),[[T,e.uploading]]),h((r(),I(v,{disabled:!e.selectedFile.file,type:"success",onClick:N},{default:o(()=>[s("上传")]),_:1},8,["disabled"])),[[T,e.uploading]])]),default:o(()=>[u("div",null,[h((r(),I(x,null,{default:o(()=>[l(g,null,{default:o(()=>[l(_,{placeholder:"文件描述信息",modelValue:e.addInfo.fileinfo,"onUpdate:modelValue":n[4]||(n[4]=t=>e.addInfo.fileinfo=t)},null,8,["modelValue"])]),_:1}),l(g,null,{default:o(()=>[l(v,{onClick:B},{default:o(()=>[s("浏览...")]),_:1}),s("      "),e.selectedFile.file?(r(),I(j,{key:0},{default:o(()=>[s(y(e.selectedFile.name)+" | "+y(p(F).formatFileSize(e.selectedFile.size)),1)]),_:1})):k("",!0)]),_:1})]),_:1})),[[T,e.uploading]])])]),_:1},8,["modelValue"])]),u("div",null,[l(S,{modelValue:e.fvisible,"onUpdate:modelValue":n[7]||(n[7]=t=>e.fvisible=t),title:"文件预览","close-on-click-modal":!1},{default:o(()=>[u("div",null,[l(ve,{info:e.vfile},null,8,["info"])])]),_:1},8,["modelValue"])])])):(r(),w("div",be,[u("a",{href:"javascript:void(0)",onClick:n[8]||(n[8]=t=>p(d).push("/manage/login"))},"请先登录...")]))}}});const Be=$(we,[["__scopeId","data-v-a7e0bc2c"]]);export{Be as default};
